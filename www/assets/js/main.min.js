/* 
 * The MIT License
 *
 * Copyright 2017 Jean Carlo de Elias Moreira.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,wsaqaaaaaaaa
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 *==============================================================================
 *
 * NFASimulator
 * Javascript Object
 *
 * @author     Jean Carlo de Elias Moreira | https://www.jeancarloem.com
 * @license    MIT | https://opensource.org/licenses/MIT
 * @copyright  © 2017 Jean Carlo EM
 * @link       https://opensource.jeancarloem.com/NFASimulator/ 
 */

(function(a,b){a.updateTbl=function(f,j,c,e,d,h){var g=b("#passos tr");if((!g)||(g.length<=0)){if((!b("article"))||(b("article").length<=0)){throw"ARTICLE NADA AINDA"}b("article").append("<div><table id='passos' cellpadding='0' cellspacing='0'><tr></tr><tr></tr></table></div>");g=b("#passos tr")}if((h===0)||(h===2)){if(b("#passos tr:last-of-type td").length<=j){g.append("<td id='td_"+j+"'>")}if(b("#passos tr td:last-of-type div.q"+d).length<=0){var i=b("#passos tr:last-of-type td#td_"+j);i.append("<div class='"+((h===0)?" epson":"")+((a.lfacalc.dts.finais.indexOf(d)>=0)?" final":"")+" q"+d+"'><span>q"+d+"</span></div>")}}if((h===3)&&(!b("#passos tr:first-of-type td#td_"+(j-1)).html())){b("#passos tr:first-of-type td#td_"+(j-1)).html(f)}};a.setSigma=function(){var e=b("section.principal div.sigma input[type='text']");e.val(e.val().replace(/(.)(?=.*\1)/g,""));if(e.val()!==e.attr("old")){b("#estados").html(" ");b("section.principal div.avaliar").css("display","none");if(e.val().length>1){var c="";for(var d=0;d<e.val().length;d++){c+="<td>"+((e.val()[d]==="@")?"&epsilon;":e.val()[d])+"</td>"}b("#estados").html("<tr><td>ST</td>"+c+"</tr>");b("section.principal div.tbl").css("display","inline-block")}e.attr("old",e.val())}};a.validadeEstados=function(k,c){c=(c===true||c===false)?c:false;k=c?k:b(this);k.removeClass("vazio erro");var h=k.val().replace(/[\[\],\s]*/g,"");if(k.val().length<=0){k.addClass("vazio");return true}var g=true;if(h.length>0){var d=new RegExp(k.attr("regex"));if(d.test(k.val())){var j=b("#estados tr.estados").length;for(var f=0;f<h.length;f++){if(parseInt(h[f])>=j){g=false;break}}}else{g=false}}else{g=false}if(!g){k.addClass("erro");return false}return true};b(document).ready(function(){b("section.principal > div div.sigmago").on("click",function(){a.setSigma()});b("section.principal div.sigma input").on("keyup",function(c){if(c.keyCode===13){b(this).blur()}});b("section.principal div.sigma input").on("blur",function(c){a.setSigma()});b("section.principal div.avaliar input").on("keyup",function(c){if(c.keyCode===13){b(this).blur()}});b("section.principal div.avaliar input").on("blur",function(c){b("section.principal div.avaliar > div").trigger("click")});b("section.principal div.tbl button").on("click",function(){var e=b("section.principal > div input[type='text']");if(e.attr("old").length>1){var c="";for(var d=0;d<e.val().length;d++){c+="<td><input name='q"+(b("#estados tr").length-1)+"_"+(b.trim(b("#estados tr:first-of-type td").eq(d+1).text()))+"' type='text' class='destinos' regex='^s?([0-9]|\\[s?[0-9](s?,s?[0-9])*s?])?s?$'></input></td>"}b("#estados").append("<tr class='estados q"+(b("#estados tr").length-1)+"' st='"+(b("#estados tr").length-1)+"'><td class=\"estado\" st='"+(b("#estados tr").length-1)+"'>q"+(b("#estados tr").length-1)+"</td>"+c+"</tr>");b("#estados tr td:first-of-type").off("click");b("#estados tr td input").off("keyup");b("#estados tr td input").off("blur");b("#estados tr td input").on("keyup",a.validadeEstados);b("#estados tr td input").on("blur",a.validadeEstados);b("#estados tr > td:first-of-type").on("click",function(f){b(this).toggleClass("checked")});b("section.principal div.avaliar").css("display","block")}});b("section.principal div.avaliar > div").on("click",function(){if(b("section.principal div.avaliar input").val().length>0){var g=b("#estados tr td input");var m=true;if(g.length>0){for(var f=0;f<g.length;f++){var k=b(g[f]);if(!a.validadeEstados(k,true)){m=false;break}}}else{m=false}if(m){var o={abto:(b("section.principal div.sigma input").val().split("")),destinos:[],start:0,finais:[],steps:[[]]};for(var f=0;f<o.abto.length;f++){o.abto[f]=o.abto[f]==="@"?null:o.abto[f]}var l=b("#estados tr > td.estado:first-of-type");for(var f=0;f<l.length;f++){if(b(l[f]).hasClass("checked")){o.finais.push(parseInt(b(l[f]).attr("st")))}}var h=b("#estados tr.estados");for(var f=0;f<h.length;f++){var c=b(h[f]).attr("st");var n=[];for(var e=0;e<o.abto.length;e++){var d=b("#estados tr td input[name='q"+c+"_"+o.abto[e]+"']").val();n.push(!d?null:(parseInt(d)))}o.destinos.push(n)}if(!a.lfacalc){a.lfacalc=new a.lfa()}b("article").html(" ");if(a.lfacalc.match(o,b("section.principal div.avaliar input").val(),a.updateTbl)){b("div.resultado").html("O Automoto reconhece a string. String aceita!")}else{b("div.resultado").html("O Automoto NÃO reconhece a string. String rejeitada!")}}else{alert("O estados destinos não estão preenchidos corretamente!")}}else{alert("Nenhuma string a ser avaliada.")}})})})(window,(typeof jQuery==="object"?jQuery:Zepto));